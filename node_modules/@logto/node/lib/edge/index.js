import { createRequester } from '@logto/client';
export { PersistKey } from '@logto/client';
import LogtoNodeBaseClient from '../src/client.js';
import { generateCodeChallenge, generateCodeVerifier, generateState } from './generators.js';

// Used for edge runtime, currently only NextJS.
class LogtoClient extends LogtoNodeBaseClient {
    constructor(config, adapter) {
        super(config, {
            ...adapter,
            requester: createRequester(config.appSecret
                ? async (...args) => {
                    const [input, init] = args;
                    // Encode to base64 using btoa
                    const base64Credentials = btoa(`${config.appId}:${config.appSecret ?? ''}`);
                    return fetch(input, {
                        ...init,
                        headers: {
                            Authorization: `Basic ${base64Credentials}`,
                            ...init?.headers,
                        },
                    });
                }
                : fetch),
            generateCodeChallenge,
            generateCodeVerifier,
            generateState,
        });
    }
}

export { LogtoClient as default };
